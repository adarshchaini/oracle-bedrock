<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-09-10 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150910" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Oracle Tools &#x2013; The Coherence Module for Oracle Tools</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.1.min.js"></script>

                          
        
<script src="js/site.js" type="text/javascript"></script>
                      
        
<link rel="shortcut icon" href="images/oracletools-logo.ico"/>
          
                  </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/coherence-community/oracle-tools/">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Oracle Tools Site</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-09-10
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 2.0.0-RC10-SNAPSHOT
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Oracle Tools</li>
                              
      <li>
  
                          <a href="../index.html" title="Welcome">
          <i class="none"></i>
        Welcome</a>
            </li>
                
      <li>
  
                          <a href="../adoption.html" title="Adoption">
          <i class="none"></i>
        Adoption</a>
            </li>
                
      <li>
  
                          <a href="../history.html" title="Change History">
          <i class="none"></i>
        Change History</a>
            </li>
                              <li class="nav-header">Recommended Reading</li>
                              
      <li>
  
                          <a href="../core/deferreds.html" title="Deferred References">
          <i class="none"></i>
        Deferred References</a>
            </li>
                
      <li>
  
                          <a href="../runtime/applications.html" title="Application Management">
          <i class="none"></i>
        Application Management</a>
            </li>
                              <li class="nav-header">Modules</li>
                              
      <li>
  
                          <a href="../core/index.html" title="Core Module">
          <i class="none"></i>
        Core Module</a>
            </li>
                
      <li>
  
                          <a href="../runtime/index.html" title="Runtime Module">
          <i class="none"></i>
        Runtime Module</a>
            </li>
                
      <li>
  
                          <a href="../testing-support/index.html" title="Testing Support Module">
          <i class="none"></i>
        Testing Support Module</a>
            </li>
                
      <li class="active">
  
            <a href="#"><i class="none"></i>Coherence Module</a>
          </li>
                              <li class="nav-header">Development</li>
                              
      <li>
  
                          <a href="../license.html" title="License">
          <i class="none"></i>
        License</a>
            </li>
                
      <li>
  
                          <a href="../release-numbers.html" title="Release Numbers">
          <i class="none"></i>
        Release Numbers</a>
            </li>
                
      <li>
  
                          <a href="../source-code.html" title="Source Code">
          <i class="none"></i>
        Source Code</a>
            </li>
                
      <li>
  
                          <a href="../building.html" title="Build Instructions">
          <i class="none"></i>
        Build Instructions</a>
            </li>
                
      <li>
  
                          <a href="../issue-tracking.html" title="Issue Tracking">
          <i class="none"></i>
        Issue Tracking</a>
            </li>
                
      <li>
  
                          <a href="../contributions.html" title="Contributions">
          <i class="none"></i>
        Contributions</a>
            </li>
                
      <li>
  
                          <a href="../logging.html" title="Logging">
          <i class="none"></i>
        Logging</a>
            </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section">
<h2><a name="The_Coherence_Module_for_Oracle_Tools"></a>The Coherence Module for Oracle Tools</h2>

<div class="section">
<div class="section">
<h4><a name="The_Twenty_Second_Synopsis"></a>The Twenty Second Synopsis</h4>
<p><b>What?</b> The Coherence Module for Oracle Tools allows applications to define, create, monitor and simply manage <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>-based applications, including individual Cache Servers (both storage enabled and disabled), Proxy Servers, Management Servers together with entire Coherence Clusters at runtime.</p>
<p>Technically speaking, the Coherence Module for Oracle Tools is an extension of and leverages the facilities provided by the <a href="../runtime/index.html">Runtime Module for Oracle Tools</a> to control Coherence-based applications, in much the same way that the <a href="../runtime/index.html">Runtime Module for Oracle Tools</a> controls regular Java and non-Java-based applications.</p>
<p><b>When?</b> Use the Coherence Module for Oracle Tools when you need to coordinate multiple <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a> applications, servers or clusters, especially as part of distributed application functional and integration tests or when you&#x2019;d traditionally make use of Shell/Ant/Maven/Python/Groovy et al scripting or the Java Platform <tt>java.lang.Process</tt> class.</p>
<p><b>Why?</b> Programmatically controlling and testing distributed applications can be a complicated, frustrating and error-prone matter. While the <tt>java.lang.Process</tt> and associated classes provide rudimentary mechanisms to control application processes, like <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>, developers typically need to make many assumptions about the underlying operating system, environment, platforms etc, write defensive code for said platforms or make extensive use of platform-specific scripting.</p>
<p>The Coherence Module for Oracle Tools removes these requirements and simplifies this development activity when working with <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>, making developing complex tests effortless.</p>
<p><b>How?</b> As this module is an extension to the <a href="../runtime/index.html">Runtime Module for Oracle Tools</a> module, we highly recommend reading the <a href="../runtime/applications.html">Introduction to Application Management</a> for core concepts, background information and introductory examples.</p>
<hr />
</div>
<div class="section">
<h4><a name="Distribution"></a>Distribution</h4>
<p>The Oracle Tools Coherence module is distributed as a single jar called: <tt>oracle-tools-coherence-2.0.0-RC10-SNAPSHOT.jar</tt></p>
<p>The <a class="externalLink" href="https://maven.java.net">maven.java.net</a> artifact information is as follows:</p>

<ul>
  
<li>Maven Group Id: <tt>com.oracle.tools</tt></li>
  
<li>Maven Artifact Id: <tt>oracle-tools-coherence</tt></li>
  
<li>Maven Version: <tt>2.0.0-RC10-SNAPSHOT</tt></li>
</ul>
<p>Alternatively you can downlown directly from: <img src="../images/external-link.png" alt="External Link" height="10" width="10" align="top" /></p>
<p><a class="externalLink" href="https://maven.java.net/service/local/artifact/maven/redirect?r=snapshots&amp;g=com.oracle.tools&amp;a=oracle-tools-coherence&amp;v=2.0.0-RC10-SNAPSHOT&amp;e=jar">oracle-tools-coherence-2.0.0-RC10-SNAPSHOT.jar</a></p>
</div>
<div class="section">
<h4><a name="Source_Code"></a>Source Code</h4>
<p>Source code for this and other Oracle Tools modules can be found here: <a class="externalLink" href="https://github.com/coherence-community/oracle-tools">https://github.com/coherence-community/oracle-tools</a></p></div></div></div>
<div class="section">
<h2><a name="Getting_Started"></a>Getting Started</h2>
<p>Like the <a href="../runtime/index.html">Runtime Module for Oracle Tools</a>, the Coherence Module for Oracle Tools uses the concepts of Schemas, Applications and Builders to define, control and construct <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>-based applications. The difference however is that the Coherence Module for Oracle Tools introduces several new Schemas, Applications and Builders, specifically designed for working with <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>.</p>
<p>Specifically the Coherence Module for Oracle Tools introduces the following classes:</p>
<p><b><tt>com.oracle.tools.runtime.coherence.CoherenceCacheServerSchema</tt></b>: represents the configuration of a proposed <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>-based Cache Server.</p>
<p><b><tt>com.oracle.tools.runtime.coherence.CoherenceCacheServer</tt></b>: represents a controllable runtime instance of an <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>-based Cache Server.</p>
<p><b><tt>com.oracle.tools.runtime.coherence.CoherenceClusterBuilder</tt></b>: provides a mechanism to build an entire <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a> cluster, based on a collection of CoherenceClusterMemberSchemas.</p>
<p><b><tt>com.oracle.tools.runtime.coherence.CoherenceCluster</tt></b>: provides a mechanism to represents and control a <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a> cluster, including access to individual CoherenceClusterMembers.</p></div>
<div class="section">
<h2><a name="Tutorial"></a>Tutorial</h2>
<p>The following sections provide recipes using the Coherence Module for Oracle Tools with <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a>.</p>

<div class="section">
<div class="section">
<h4><a name="Creating_a_Single_Coherence_Storage_Enabled_Server"></a>Creating a Single Coherence Storage Enabled Server</h4>
<p>The following example will create a storage-enabled Coherence Cache Server, using default configuration.</p>

<div class="source">
<div class="source">
<pre>import com.oracle.tools.runtime.LocalPlatform;
import com.oracle.tools.runtime.network.AvailablePortIterator;

import static com.oracle.tools.deferred.DeferredHelper.invoking;
import static com.oracle.tools.deferred.Eventually.assertThat;
import static org.hamcrest.CoreMatchers.is;

...

// acquire the platform on which we'll create the cluster member
LocalPlatform platform = LocalPlatform.getInstance();

// acquire a set of available ports on the platform
AvailablePortIterator availablePorts = platform.getAvailablePorts();

// define the schema for a Coherence Cache Server
CoherenceCacheServerchema schema =
    new ClusterMemberSchema()
        .setClusterPort(availablePorts)    //automatically choose an available port!
        .useLocalHostMode();

// the console for i/o
SystemApplicationConsole console = new SystemApplicationConsole();

try (CoherenceCacheServer server = platform.realize(&quot;test-server&quot;, schema, console))
{
    // assert that (eventually) the cluster details are as expected
    Eventually.assertThat(invoking(server).getLocalMemberId(), is(1));
    Eventually.assertThat(invoking(server).getClusterSize(), is(1));
}
</pre></div></div>
<p>Important concepts from the above example:</p>

<div class="section">
<h5><a name="AvailablePortIterators:"></a>AvailablePortIterators:</h5>
<p><tt>AvailablePortIterator</tt>s free developers from working out available server socket ports on a host. All port-based parameters for <tt>CoherenceCacheServerSchema</tt> naturally accept either a specific port or an <tt>AvailablePortIterator</tt>. By using <tt>AvailablePortIterator</tt>s it&#x2019;s highly unlikely you&#x2019;ll ever have to set a Coherence cluster port.</p>
<p>To determine the port that is actually used for a <tt>CoherenceCacheServer</tt>, simply use the <tt>CoherenceCacheServer.getClusterPort()</tt> method.</p>
</div>
<div class="section">
<h5><a name="Use_Local_Host_Mode:"></a>Use Local Host Mode:</h5>
<p>The <tt>useLocalHostMode</tt> property of a <tt>CoherenceCacheServerSchema</tt> automatically sets the <tt>CoherenceCacheServer</tt> to use a TTL of 0 and binds the localhost to a suitable localhost address.</p>
<p>Using &#x201c;useLocalHostMode&#x201d; eliminates the need to determine the cluster address on which a <tt>CoherenceCacheServer</tt> should listen. The downside being, that only <tt>CoherenceCacheServer</tt>s on the said host will cluster together, and not across hosts.</p>
</div>
<div class="section">
<h5><a name="Eventually.assertThat...:"></a>Eventually.assertThat(...):</h5>
<p>The use of the <tt>Eventually</tt> class, together with Deferred References, allows developers to write test cases and assertions on asynchronous tasks without requiring <tt>Thread.sleep(...)</tt> calls to wait for tasks to complete.</p>
</div>
<div class="section">
<h5><a name="CoherenceCacheServerSchema:"></a>CoherenceCacheServerSchema:</h5>
<p>The <tt>CoherenceCacheServerSchema</tt> class provides all of the typically used <a class="externalLink" href="http://www.oracle.com/technetwork/middleware/coherence/overview/index.html" title="Oracle Coherence">Oracle Coherence</a> properties that an application developer would set, including those at the command-line.</p>
<p>Some of the available options include:</p>

<div class="source">
<div class="source">
<pre>setCacheConfigURI(String)
setOperationalOverrideURI(String)

setPofConfigURI(String)
setPofEnabled(boolean)

setStorageEnabled(boolean)

setLocalHostAddress(String)
setLocalHostPort(int)

setWellKnownAddress(String)
setWellKnownAddressPort(int)

setTCMPEnabled(boolean)

setMulticastTTL(int)

setClusterPort(int)
setClusterPort(Iterator&lt;Integer&gt; ports)

useLocalHostMode()

setClusterName(string)
setRoleName(String)
setSiteName(String)

setJMXManagementMode(JMXManagementMode)
setRemoteJMXManagement(boolean)

setLogLevel(int)
setLog(String)
</pre></div></div>
<p>For the complete list of available options, please consult the Java Doc for the <tt>CoherenceCacheServerSchema</tt> class.</p>
</div></div>
<div class="section">
<h4><a name="Creating_a_Single_Coherence_Storage_Disabled_Server"></a>Creating a Single Coherence Storage Disabled Server</h4>
<p>Creating a storage-disabled Cache Server is as simple as setting the <tt>setStorageEnabled</tt> property of a <tt>CoherenceCacheServerSchema</tt> to <tt>false</tt>.</p>

<div class="source">
<div class="source">
<pre>// define a cluster member
CoherenceCacheServerSchema schema =
    new CoherenceCacheServerSchema()
        .setClusterPort(availablePorts)
        .useLocalHostMode()
        .setStorageEnabled(false);          //storage disabled!
</pre></div></div>
</div>
<div class="section">
<h4><a name="Creating_a_Cluster_of_Coherence_Storage_Enabled_Servers"></a>Creating a Cluster of Coherence Storage Enabled Servers</h4>
<p>While creating individual Cache Servers is useful, typically applications and integration tests require multiple cluster members, arranged as a Coherence Cluster.</p>
<p>To simplify representing, building and managing multiple <tt>CoherenceCacheServer</tt>s as a group of applications, ie: a <tt>CoherenceCluster</tt>, developers should use the <tt>CoherenceClusterBuilder</tt>.</p>

<div class="source">
<div class="source">
<pre>import com.oracle.tools.runtime.LocalPlatform;
import com.oracle.tools.runtime.console.SystemApplicationConsole;
import com.oracle.tools.runtime.network.AvailablePortIterator;

import static com.oracle.tools.deferred.DeferredHelper.invoking;
import static com.oracle.tools.deferred.Eventually.assertThat;
import static org.hamcrest.CoreMatchers.is;

...

// the desired cluster size
final int CLUSTER_SIZE   = 3;

LocalPlatform platform = LocalPlatform.getInstance();
AvailablePortIterator availablePorts = platform.getAvailablePorts();

// use a Capture to capture the Cluster Port to ensure
// all Cache Servers use the same port!
Capture&lt;Integer&gt; clusterPort = new Capture&lt;Integer&gt;(availablePorts);

// define the schema for an individual cache server
CoherenceCacheServerSchema schema = new CoherenceCacheServerSchema()
    .setClusterPort(clusterPort)
    .useLocalHostMode();

// configure our CoherenceClusterBuilder
CoherenceClusterBuilder clusterBuilder = new CoherenceClusterBuilder();

// instruct the builder the schema to use for some cache servers to build
clusterBuilder.addSchema(&quot;CacheServer&quot;, schema, CLUSTER_SIZE, platform);

try (CoherenceCluster cluster = clusterBuilder.realize(new SystemApplicationConsole()))
{
    // ensure that the expected cluster is created
    Eventually.assertThat(invoking(cluster).getClusterSize(), is(CLUSTER_SIZE));
}
</pre></div></div>
<p>As mentioned in the above comments, a <tt>CoherenceClusterBuilder</tt> may consist of multiple schemas, potentially across multiple platforms. This allows different Coherence topologies to be constructed.</p>
<p>For example, say you&#x2019;d like several differently configured servers in a cluster. You can use a <tt>CoherenceClusterBuilder</tt> to define easily:</p>

<div class="source">
<div class="source">
<pre>clusterBuilder.addSchema(&quot;Storage&quot;, storageSchema, nrStorageMembers, platform);
clusterBuilder.addSchema(&quot;Proxy&quot;, proxySchema, nrProxyMembers, platform);
clusterBuilder.addSchema(&quot;Management&quot;, managementSchema, nrManagementMembers, platform);
</pre></div></div>
<p>When the <tt>CoherenceClusterBuilder.realize(...)</tt> method is called, an entire cluster consisting of the appropriate number of members will be built and returned as a <tt>CoherenceCluster</tt>.</p></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                   2015.
          All rights reserved.      
                    
      </p>
        </div>

                                                                  
<div class="copyright">Copyright © 2008-2013 Oracle Corporation. All rights reserved.</div>
                                                          
<div class="version">Version 2.0.0-RC10-SNAPSHOT: 2015-09-10 18:09</div>
                  
        
                </div>
    </footer>
        </body>
</html>
